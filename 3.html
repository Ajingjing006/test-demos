<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no,shrink-to-fit=no">
		<title>输入框demo</title>
		<style>
			body {
				padding: 0;
				margin: 0;
			}

			.form {
				padding: 50px;
			}

			.field-cont {
				position: relative;
				box-sizing: border-box;
				border: 1px solid black;
				height: 50px;
			}

			.mark {
				position: absolute;
				left: 0;
				top: 50%;
				font-size: 15px;
				line-height: 20px;
				transform: translateY(-50%);
				pointer-events: none;
				color: transparent;
			}

			#abc {
				font-size: 15px;
				line-height: 20px;
				border: none;
				padding: 0;
				height: 100%;
			}

			.mark::after {
				position: absolute;
				display: inline-block;
				height: 30px;
				line-height: 30px;
				padding: 0 4px;
				background: rgba(0, 0, 0, 0.8);
				left: 50%;
				transform: translate(-50%, -100%);
				white-space: nowrap;
				color: #fff;
			}

			.mark.show-mark::after {
				content: attr(data-mark);
			}
		</style>
	</head>
	<body>
		<div class="form">
			<div class="field-cont">
				<div class="mark"></div>
				<input id="abc" type="text" />
			</div>
		</div>
	</body>
	<script>
		//数据mapping表
		var keyList = [{
			key: 1000,
			text: "千"
		}, {
			key: 10000,
			text: "万"
		}, {
			key: 100000,
			text: "十万"
		}, {
			key: 1000000,
			text: "百万"
		}, {
			key: 10000000,
			text: "千万"
		}, {
			key: 100000000,
			text: "亿"
		}, {
			key: 1000000000,
			text: "十亿"
		}, {
			key: 10000000000,
			text: "百亿"
		}, {
			key: 100000000000,
			text: "千亿"
		}];
		abc.addEventListener('input', inputHandler);

		//输入框输入监听事件
		function inputHandler(e) {
			let value = removeFormat(abc.value);
			console.log('removeFormat', value);
			let markText = getFirstMark(value);
			let thValue = format(value);
			abc.value = thValue;
			console.log('thValue', thValue);
			let markDom = document.querySelector('.mark');
			markDom.setAttribute('data-mark', markText);
			if (value.length) {
				markDom.innerText = value.substr(0, 1);
			} else {
				markDom.innerText = "";
			}
			if (markText) {
				document.querySelector('.mark').classList.add('show-mark');
			} else {
				document.querySelector('.mark').classList.remove('show-mark');
			}
		}

		//去掉千分
		function removeFormat(val) {
			let result = val.replace(/,/g, '');
			return result;
		}

		//做千分功能
		function format(val) {
			let result;
			let t2 = '';
			let hasT = false;
			if (val.indexOf('.') > -1) {
				hasT = true;
				let arr = val.split('.');
				val = arr[0];
				t2 = arr[1];
				if (t2.length > 2) {
					t2 = t2.substr(0, 2);
				}
			}
			let reg = /\d{1,3}(?=(\d{3})+$)/g;
			result = val.replace(reg, '$&,');
			if (hasT) {
				result += '.' + t2;
			}
			console.log(result)
			return result;
		}

		//获得首位数字的权重
		function getFirstMark(val) {
			for (let i = keyList.length - 1; i >= 0; i--) {
				let item = keyList[i];
				let result = Math.round(val / item.key);
				if (result > 0) {
					return item.text;
				}
			}
			return ""
		}
		
		function testClosure(abc) {
			window.fn = window.fn || (
			()=>{
				console.log(abc)
			})
			window.fn();
		}
		testClosure(123);
		testClosure(456);
	</script>
</html>
