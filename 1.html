<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" />
        <title>绘制海报</title>
        <style>
            body {
                padding: 0;
                margin: 0;
            }

            #canvas {
                border: 1px solid red;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas" width="375" height="800"></canvas>
    </body>
    <script src="./jquery.min.js"></script>
    <script>
        function PosterDraw(options) {
            var _y = 0;
            draw(options);
            //获取画布
            function getCanvas() {
                return document.querySelector('#canvas');
            }

            //开始绘制
            function draw(options) {
                var w = 375; //画布宽度
                var h = 500; //画布高度
                drawImage(options, function(options) {
                    fillText(options.text);
                });
            }

            //绘制图片
            function drawImage(options, callBack) {
                var ctx = getCanvas().getContext('2d'); //画布上下文
                loadImage(options.imgUrl, (image) => {
                    ctx.drawImage(image, 0, 0, image.width, image.height);
                    _y += image.height;
                    callBack(options);
                });
            }

            //加载图片
            function loadImage(url, callBack) {
                var image = $('<img>');
                image[0].onload = function() {
                    callBack(image[0]);
                }
                image.attr('src', url);
            }

            function fillText(list) {
                var ctx = getCanvas().getContext('2d'); //画布上下文
                for (var i = 0, l = list.length; i < l; i++) {
                    var item = list[i];
                    ctx.font = item.style;
                    ctx.fillStyle = item.color;
                    fitFillText(ctx, item);
                }
            }

            function fitFillText(ctx, data) {
                var text = data.text;
                while (text) {
                    var tEvery = getMatchWidthText(text, data.maxWidth);
                    text = text.substr(tEvery.length);
                    _y += data.lineHeight;
                    ctx.fillText(tEvery, data.x, data.y + _y);
                }

                function getMatchWidthText(_str, maxw) {
                    var measureData = ctx.measureText(_str);
                    var maxWidth = measureData.width;
                    while (maxWidth > maxw) {
                        _str = _str.substr(0, _str.length - 1);
                        maxWidth = ctx.measureText(_str).width;
                    }
                    return _str;
                }
            }
        }

        new PosterDraw({
            imgUrl: "https://himg.bdimg.com/sys/portrait/item/wise.1.fd1f3d3f.7ckO1gSJmFFcsFPsKARomQ.jpg?time=11230",
            text: [{
                text: "hello world！hello world！hello world！hello world！hello world！hello world！hello world！",
                style: "18px serif",
                lineHeight: 20,
                maxWidth: 200,
                color: "#000000",
                x: 100,
                y: 0
            },{
                text: "中国话总过中国话总过中国话总过中国话总过中国话总过中国话总过中国话总过中国话总过中国话总过中国话总过中国话总过",
                style: "20px 微软雅黑",
                lineHeight: 20,
                maxWidth: 300,
                color: "#ff00ff",
                x: 0,
                y: 0
            }]
        });
    </script>
</html>
